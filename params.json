{"name":"cmasotti.GitHub.io","tagline":"RNAseq_tutorial","body":"# **1st Summer School of Bioinformatics - 15th to 19th February, 2016**  \r\n## RNAseq tutorial   \r\n**_by cmasotti@mochsl.org.br_**  \r\n\r\nLearning objectives of this \"hands-on\" part of the course:\r\n+ Provide a working example of RNAseq raw-data analysis pipeline  \r\n+ Run major analysis steps in a reasonable amount of time with modest computer resources  \r\n+ Get familiar with command-line based softwares  \r\n+ Get familiar with major file formats (inputs and outputs)  \r\n+ Get familiar with gene expression estimates  \r\n+ Discuss common technical issues related to RNAseq studies  \r\n+ Get help outside of this course  \r\n\r\nThis tutorial includes:  \r\n+ Softwares to install: not all softwares will necessarily presented     \r\n+ Files to download: see analysis pipeline for \"saving files\" instructions   \r\n+ Analysis pipeline: based on Tuxedo protocol (Trapnell et al. 2012)\r\n\r\n# Analysis Pipeline\r\n\r\n## Information about RNAseq data used in this tutorial\r\n**SRA=Sequence Read Archive**  \r\nhttp://www.ncbi.nlm.nih.gov/sra  \r\nRaw sequencing and alignment data available to research community!  \r\n\r\n__Illumina Human Body Map 2.0 Transcriptome Project__    \r\nhttp://www.ncbi.nlm.nih.gov/Traces/study/  \r\nSRA Study: ERP000546  \r\nSamples: ERR030874, ERR030872, ERR030875, ERR030873, ERR030876, ERR030885, ERR030878, ERR030882, ERR030886, ERR030887, ERR030883, ERR030880, ERR030881, ERR030877, ERR030884, ERR030879.  \r\n  \r\n## Files to download  \r\n### Reference files  \r\nWe need a genome against which to align our reads (fasta file):  \r\nDownload the reference genome from _UCSC Browser_ (hg19 – GRCh37; Feb 2009 assembly):    \r\n```bash\r\nwget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/chromosomes/chr19.fa.gz  \r\ngunzip chr19.fa.gz  \r\n```  \r\nWe need a reference gene annotation to quantify expression of known transcripts (.gtf file):  \r\nDownload the _human GENCODE Gene Set_:   \r\nGENCODE: http://www.gencodegenes.org/releases/  \r\n```bash\r\nwget ftp://ftp.sanger.ac.uk/pub/gencode/Gencode_human/release_16/gencode.v16.annotation.gtf.gz  \r\ngunzip gencode.v16.annotation.gtf.gz  \r\ngrep chr19 gencode.v16.annotation.gtf > gencode.v16.annotation_chr19.gtf  \r\n```  \r\n## Working files  \r\nIn working directory, download the following files:   \r\nGenome index (used to generate Bowtie2 indexes): **hg19_chr19.fa**  \r\nTranscript annotations: **gencode.v16.annotation_chr19.gtf**  \r\nSource scripts: **sources/source_step1 to step5**  \r\n  \r\nIn working directory, create the following directories:  \r\n```bash  \r\nmkdir sources  \r\nmkdir fastq_chr19  \r\nmkdir index_chr19  \r\nmkdir fpkm_files  \r\n```   \r\nIn **fastq_chr19/**, save fastq files:  \r\n**brain_end1.fastq.gz**  \r\n**brain_end2.fastq.gz**  \r\nIn **brain/**, save: \r\n**brain_chr19.q20.sorted.bam** (chr19, Bowtie2 aligned, Q>=20, sorted)   \r\nIn **fpkm_files/**, save:  \r\n**brain_genes.fpkm_tracking, leukocyte_genes.fpkm_tracking, etc.**\r\n\r\n ## Pipeline  \r\n  \r\nFirstly, test software installation by directly typing their names on prompt.   \r\nIf they were correctly added to $PATH, a list of parameters is shown.  \r\nAll applications herein used are very well documented, and parameters are explained in **--help command** (e.g., bowtie2 –help) or online manuals.  \r\n\r\nWorking directory: **~source/**  \r\n\r\n### Step1: Creating Bowtie2 genome index \r\n(_source_step1_)  \r\n  \r\nTophat2 requires the reference **.fa** file in the same directory of Bowtie2 indexes.  \r\nMove **hg19_chr19.fa** to **index_chr19/**.  \r\n\r\n```bash  \r\nbowtie2-build ../index_chr19/hg19_chr19.fa index_chr19/hg19_chr19  \r\n# Bowtie2 will create six files:  \r\n# hg19_chr19.1.bt2  \r\n# hg19_chr19.2.bt2  \r\n# hg19_chr19.3.bt2  \r\n# hg19_chr19.4.bt2  \r\n# hg19_chr19.rev.1.bt2  \r\n# hg19_chr19.rev.2.bt2  \r\n```   \r\n\r\n### Step2: Creating Bowtie2 transcriptome index   \r\n(_source_step2_)  \r\n\r\nIn order to align the reads to known transcripts, Bowtie2 creates an index (and other associated files) to transcriptome sequences.  \r\nIn case multiple Tophat2 runs are planned with the same transcriptome, the first run must include **–G/--GTF** together with **–transcriptome-index** option to create transcriptome index files.  \r\n**–G** is not necessary for subsequent runs.  \r\n  \r\n```bash\r\ntophat2 -G ../gencode.v16.annotation_chr19.gtf --transcriptome-index=../gtf_index/gencode.v16.annotation_chr19 ../index_chr19/hg19_chr19  \r\n```  \r\n### Step3: Perform alignment with Tophat2  \r\n(_source_step3_)  \r\n\r\n_https://ccb.jhu.edu/software/tophat/tutorial.shtml#ref_   \r\n_TopHat map reads firstly by running Bowtie, which identifies places where reads map end to end._  \r\n_Bowtie will identify “islands” in your reference genome where reads piled up. Many of these islands will be exons._\r\n_TopHat will then find splice junctions using the reads that did not get mapped to an island._  \r\n\r\n```bash\r\ntophat2 -p 3 --no-coverage-search --transcriptome-index=../gtf_index/gencode.v16.annotation_chr19 -o ../brain ../index_chr19/hg19_chr19 ../fastq_chr19/brain_end1.fastq.gz ../fastq_chr19/brain_end2.fastq.gz   \r\n```  \r\nLook for parameters explanation with **tophat2 –-help**.   \r\n  \r\nTopHat will output a **.bam** file in the output directory **brain/**.  \r\n  \r\n### Step4: Quality control of alignment (SAMtools)   \r\n(_souce_step4_)  \r\n\r\nLoad fastQC, open and compare files:   \r\n**brain_end1.fastq.gz X brain_end2.fastq.gz X brain_chr19.q20.sorted**  \r\n\r\nSelect reads with Q>=20 through SAMtools and sort **.bam** files.  \r\n```bash  \r\nmv ../brain/accepted_hits.bam ../brain/brain_chr19.bam  \r\nsamtools view -b -q20 ../brain/brain_chr19.bam > ../brain/brain_chr19.q20.bam  \r\nsamtools sort  ../brain/brain_chr19.q20.bam ../brain/brain_chr19.q20.sorted  \r\nrm -f ../brain/brain_chr19.q20.bam  \r\n```  \r\n### Step5: Estimating gene expression with Cufflinks  \r\n(_source_step5_)  \r\n\r\n```bash  \r\ncufflinks -p 3 -G ../gencode.v16.annotation_chr19.gtf -o ../brain  ../brain/brain_chr19.q20.sorted.bam   \r\n```  \r\n\r\nCufflinks will generate several files, including **genes.fpkm_tracking**, which includes gene-level **FPKM** estimations.   \r\n a. Look at the same files that were generated for several tissues in **fpkm_files/**.  \r\n b. Understand FPKM estimations (Trapnell et al., 2012).  \r\n c. Explore data by loading and plotting results in **R**.  \r\n\r\n    ","google":"UA-73393434-1","note":"Don't delete this file! It's used internally to help with page regeneration."}